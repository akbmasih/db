# /root/db/postgresql/pg_hba.conf
# PostgreSQL Client Authentication Configuration for Lingudesk

# TYPE  DATABASE        USER            ADDRESS                 METHOD

# Local connections
local   all             all                                     scram-sha-256

# IPv4 local connections
host    all             all             127.0.0.1/32            scram-sha-256

# IPv6 local connections
host    all             all             ::1/128                 scram-sha-256

# Allow connections from Docker network
host    all             all             172.20.0.0/24           scram-sha-256

# Allow connections from core-net (internal servers)
host    all             db_user         10.0.0.0/24             scram-sha-256
host    all             postgres        10.0.0.0/24             scram-sha-256

# Specific server access (more restrictive)
# Auth server
host    lingudesk       db_user         10.0.0.3/32             scram-sha-256

# Credit server
host    lingudesk       db_user         10.0.0.4/32             scram-sha-256

# AI server
host    lingudesk       db_user         10.0.0.6/32             scram-sha-256

# Backend server (can access from both networks)
host    lingudesk       db_user         10.0.0.2/32             scram-sha-256
host    lingudesk       db_user         10.1.0.2/32             scram-sha-256

# Log server (read-only monitoring access)
host    lingudesk       monitoring      10.0.0.7/32             scram-sha-256

# Replication connections (for future scaling)
# host    replication     replicator      10.0.0.0/24             scram-sha-256

# Reject all other connections
host    all             all             0.0.0.0/0               reject